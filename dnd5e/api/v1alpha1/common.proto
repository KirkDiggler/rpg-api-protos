syntax = "proto3";

package dnd5e.api.v1alpha1;

import "dnd5e/api/v1alpha1/enums.proto";

option go_package = "github.com/KirkDiggler/rpg-api-protos/gen/go/dnd5e/api/v1alpha1;v1alpha1";
option java_multiple_files = true;
option java_package = "com.kirkdiggler.rpg.api.dnd5e.v1alpha1";

// Ability scores for a character
message AbilityScores {
  // Strength score (3-18 before racial modifiers)
  int32 strength = 1;

  // Dexterity score (3-18 before racial modifiers)
  int32 dexterity = 2;

  // Constitution score (3-18 before racial modifiers)
  int32 constitution = 3;

  // Intelligence score (3-18 before racial modifiers)
  int32 intelligence = 4;

  // Wisdom score (3-18 before racial modifiers)
  int32 wisdom = 5;

  // Charisma score (3-18 before racial modifiers)
  int32 charisma = 6;
}

// Common error details for D&D 5e validation
message ValidationError {
  // Field that failed validation
  string field = 1;

  // Human-readable error message
  string message = 2;

  // Error code for programmatic handling
  string code = 3;
}

// Dice notation for various game mechanics
message DiceRoll {
  // Number of dice
  int32 count = 1;

  // Die size (4, 6, 8, 10, 12, 20, 100)
  int32 size = 2;

  // Modifier to add/subtract
  int32 modifier = 3;

  // String representation (e.g., "1d20+5")
  string notation = 4;
}

// Modifier with a source for tracking
message Modifier {
  // The ability or skill being modified
  string target = 1;

  // The modifier value (can be negative)
  int32 value = 2;

  // Source of the modifier (e.g., "racial", "class feature")
  string source = 3;

  // Type of modifier (e.g., "enhancement", "circumstance")
  string type = 4;
}

// Resource tracking (spell slots, hit dice, etc.)
message Resource {
  // Resource name
  string name = 1;

  // Current value
  int32 current = 2;

  // Maximum value
  int32 maximum = 3;

  // When the resource refreshes ("short rest", "long rest", "daily")
  string refresh_on = 4;
}

// Status effect or condition
message Condition {
  // Condition name (e.g., "poisoned", "frightened")
  string name = 1;

  // Source of the condition
  string source = 2;

  // Duration in rounds (-1 for indefinite)
  int32 duration = 3;

  // Any additional notes
  string notes = 4;

  // Condition identifier (maps to toolkit condition ref)
  ConditionId id = 5;
  // Raw JSON from toolkit for UI display (duration, stacks, bonuses, etc.)
  bytes condition_data = 6;
}

// Validation warning (non-blocking)
message ValidationWarning {
  // Field with warning
  string field = 1;

  // Warning message
  string message = 2;

  // Warning severity/type
  string type = 3;
}

// Validation result matching toolkit's 3-tier system
message ValidationResult {
  // Severity levels for validation issues
  enum Severity {
    SEVERITY_UNSPECIFIED = 0;
    SEVERITY_ERROR = 1; // Critical issues that prevent character use
    SEVERITY_INCOMPLETE = 2; // Missing required choices (OK for drafts)
    SEVERITY_WARNING = 3; // Non-blocking issues like duplicates
  }

  // Individual validation issue
  message Issue {
    Severity severity = 1;
    ValidationSource source = 2; // Where the issue originates
    ValidationField field = 3; // What field has the issue
    string message = 4; // Human-readable description
    repeated string details = 5; // Additional context (e.g., conflicting choices)
    string source_detail = 6; // Optional: specific source ID (e.g., "fighter", "elf")
  }

  // Whether the character/draft is valid for its current state
  bool is_valid = 1;

  // All validation issues found
  repeated Issue issues = 2;

  // Quick access to counts by severity
  int32 error_count = 3;
  int32 incomplete_count = 4;
  int32 warning_count = 5;
}

// Sources of validation issues (matches toolkit constants)
enum ValidationSource {
  VALIDATION_SOURCE_UNSPECIFIED = 0;
  VALIDATION_SOURCE_RACE = 1;
  VALIDATION_SOURCE_CLASS = 2;
  VALIDATION_SOURCE_BACKGROUND = 3;
  VALIDATION_SOURCE_ABILITY_SCORES = 4;
  VALIDATION_SOURCE_NAME = 5;
  VALIDATION_SOURCE_ALIGNMENT = 6;
  VALIDATION_SOURCE_LEVEL = 7;
  VALIDATION_SOURCE_SUBRACE = 8; // Validation from subrace selection
}

// Fields that can have validation issues (matches toolkit constants)
enum ValidationField {
  VALIDATION_FIELD_UNSPECIFIED = 0;
  VALIDATION_FIELD_SKILLS = 1;
  VALIDATION_FIELD_LANGUAGES = 2;
  VALIDATION_FIELD_EQUIPMENT = 3;
  VALIDATION_FIELD_SPELLS = 4;
  VALIDATION_FIELD_CANTRIPS = 5;
  VALIDATION_FIELD_TOOLS = 6;
  VALIDATION_FIELD_EXPERTISE = 7;
  VALIDATION_FIELD_FIGHTING_STYLE = 8;
  VALIDATION_FIELD_ABILITY_SCORES = 9;
  VALIDATION_FIELD_NAME = 10;
  VALIDATION_FIELD_RACE = 11;
  VALIDATION_FIELD_CLASS = 12;
  VALIDATION_FIELD_BACKGROUND = 13;
  VALIDATION_FIELD_DRACONIC_ANCESTRY = 14;
  VALIDATION_FIELD_SUBRACE = 15; // Subrace selection
  VALIDATION_FIELD_TRAITS = 16; // Generic racial/class traits
}

// SourceRef identifies the source of damage, effects, or other game mechanics.
// Uses oneof to support different source categories while reusing existing enums.
message SourceRef {
  oneof source {
    // Damage from a weapon
    Weapon weapon = 1;

    // Damage from ability modifier (STR, DEX, etc.)
    Ability ability = 2;

    // Damage from an active condition (rage bonus, sneak attack dice, etc.)
    ConditionId condition = 3;

    // Damage from a class/racial feature (breath weapon, radiance of dawn, etc.)
    FeatureId feature = 4;

    // Damage from a spell (fireball, magic missile, etc.)
    Spell spell = 5;

    // Damage modifier from a monster trait (vulnerability, resistance, immunity)
    MonsterTraitId monster_trait = 6;
  }
}
